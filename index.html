<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="ArthurChi&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ArthurChi&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ArthurChi&#39;s Blog">





  
  
  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ArthurChi's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ArthurChi's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Yesterday you said tomorrow</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/05/等待-静候花开/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/09/05/等待-静候花开/" class="post-title-link" itemprop="url">等待-静候花开</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-09-05 21:35:25 / Modified: 22:48:08" itemprop="dateCreated datePublished" datetime="2020-09-05T21:35:25+08:00">2020-09-05</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一转眼2020年过了一大半了, 而我距离那个让我恐惧的年龄又近了一岁, 都说35基本就是程序员的大限, 虽然不知道是真是假, 但是隐约记得之前那些大龄的程序员来面试时, 其他人异样的眼光, 想想让人后背发凉. 而这一年我又做了一个近乎疯狂的决定–转岗, 从原来的FaceU团队转到了AI-LAB, 在外人看来, 这是一个华丽丽的转身, 但是, 其中辛酸只有自己知道, 几乎一多半的东西都是新的, 很多概念不知道, 而且因为在图形图像这个领域是个新手, 很多在老手眼里简单的活, 我都要弄很久. 想想刚转过来的时候, 一个通道数对不上的问题, 卡了我好久. 因为是异地多团队配合, 有时一个环境问题可能要折腾一天, 庆幸的是, 我遇到了愿意给我机会的组长. </p>
<p>说到转岗的原因, 我是想接触一下底层, 看看这整个流程是怎样work起来的, 从相机获取到一帧图像, 到屏幕显示出绚丽的效果, 这中间到底经历了什么. 现在的工作, 更多的是跨平台和cpp的东西, 然后写一些gl的shader. 只是我习惯了iOS开发, 所以平时这一套都在Xcode中完成, 偶尔遇到了问题, 可能需要到AS上去看一下. 人的能力都是用进废退的, 为了不把之前所拥有的iOS能力遗忘掉, 在工作之余, 会看一些iOS的资料, 写一些自己感兴趣的小玩意. 同时, 我想把自己的想法记录下来, 因为这同样很有趣, 就像今天, 我翻看了我之前写的日志, 感觉惨不忍睹, 简直太弱了. 这感觉就像看自己几年前的代码一样, 想重构它. 这样, 我才能真切的感受到自己的进步. </p>
<p>来到字节快三年了, 真心非常感谢之前的相机团队的同学和我的leader, 机缘巧合, 也做过FaceU这个项目的iOS的owner, 那段时间, 它真的就像自己的孩子一样, 上线前, 支持bug的修复, 清理上一个版本出现的新增crash, 系统测试中出现的性能劣化, 对它进行组件化, 让它更加整洁干净, 还要同步需求, 分解任务, 代码review. 那段时间, 每天回到家, 整个人已经筋疲力尽了, 其他的什么写日志什么的, 完全是奢望, 所以我已经有很久没有写东西了. 最近在出差, 周末就空闲了下来, 于是想着可以写点什么. 回想到FaceU, 因为在我接手时, 它已经是一个比较成熟的项目了, 所以没有从0到1的感受过一个相机项目, 或者说, 有一些细节我不曾了解, 于是我有了一个想法, 利用平时的时间, 自己写一个小相机, 这样还能利用到现在所学, 模仿写一些滤镜.</p>
<p>如果你看到了这里, 我希望你不要转载这篇日志, 因为这只是我自己对自己的想法的一个记录, 以便以后回过头来看自己之前的想法的.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/18/权限请求/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/12/18/权限请求/" class="post-title-link" itemprop="url">权限请求</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-12-18 19:53:13" itemprop="dateCreated datePublished" datetime="2019-12-18T19:53:13+08:00">2019-12-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-09-08 22:38:04" itemprop="dateModified" datetime="2020-09-08T22:38:04+08:00">2020-09-08</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇文章, 写于去年的12月, 但一直没有发, 直到今天才发出来, 本想写一个简单的相机的app, 然后记录一下这个过程, 等整体完成后, 再发布出来, 但是这期间经历了很多变化, 时间被工作充斥了, 好多事情都搁置了, 今天挤出一些时间, 把它发出来. 2020-9-8</p>
<h1 id="开篇"><a href="#开篇" class="headerlink" title="开篇"></a>开篇</h1><p>权限请求, 在这样的一个多媒体的app中, 是经常用到的, 没有这些权限, 就没法访问摄像头, 麦克风, 这篇文章中, 会先用常规的写法来请求权限, 然后, 一步一步的封装一个权限请求的小组件</p>
<h1 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h1><p>首先, 一个权限请求的过程应该是这样的:</p>
<p>先判断有没有请求过相关的权限, 如果请求过, 则直接返回结果, 否则就进行请求, 并将请求的结果通知给业务方. 以摄像头的权限请求为例</p>
<p>为了语义清晰, 先定义一个closure的类别描述, 用于描述权限请求的回调类型</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">AuthorityCallback</span> = (<span class="type">Bool</span>) -&gt; <span class="type">Void</span></span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAuthorityIfNeed</span><span class="params">(<span class="number">_</span> resultBlock: @escaping AuthorityCallback)</span></span> &#123;</span><br><span class="line">            <span class="keyword">let</span> authorityStatus = <span class="type">AVCaptureDevice</span>.authorizationStatus(<span class="keyword">for</span>: .video)</span><br><span class="line">            <span class="keyword">guard</span> authorityStatus == .notDetermined <span class="keyword">else</span> &#123;</span><br><span class="line">                resultBlock(authorityStatus == .authorized)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">AVCaptureDevice</span>.requestAccess(<span class="keyword">for</span>: .video, completionHandler: &#123; (result) <span class="keyword">in</span></span><br><span class="line">                resultBlock(result)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>看起来还好, 那么接下来麦克风的权限, 我们只需要把类别改为audio即可, 像这样</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AVCaptureDevice</span>.requestAccess(<span class="keyword">for</span>: .audio, completionHandler: &#123; (result) <span class="keyword">in</span></span><br><span class="line">                resultBlock(result)</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure>
<p>当然, 基于DRY原则, 要对上面的函数的参数进行扩展, 传递一个类型, 用来区别倒到底是请求哪种类型的权限. 那么问题来了, 如果后面要添加相册权限呢? push权限呢? 这就变得不好处理了, 当然, 可以通过传递类型和回调函数来把这些类型区分开. 但是每当需要增加新的类别, 就需要把这个文件进行修改. 这个并不是一个好的设计.</p>
<p>实际上, 那段判断并不需要</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> authorityStatus = <span class="type">AVCaptureDevice</span>.authorizationStatus(<span class="keyword">for</span>: .video)</span><br><span class="line">            <span class="keyword">guard</span> authorityStatus == .notDetermined <span class="keyword">else</span> &#123;</span><br><span class="line">                resultBlock(authorityStatus == .authorized)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>因为根据文档, 是这样描述的:</p>
<blockquote>
<p>The response parameter is a block whose sole parameter indicates whether the user granted or denied permission to record. This method always returns immediately. If the user has previously granted or denied recording permission, it executes the block when called; otherwise, it displays an alert and executes the block only after the user has responded to the alert.</p>
</blockquote>
<h1 id="抽象分析"><a href="#抽象分析" class="headerlink" title="抽象分析"></a>抽象分析</h1><p>我们对这些权限的行为有两个:</p>
<ol>
<li>查询权限状态</li>
<li>请求权限, 并得知结果</li>
</ol>
<p>那么, 将这个作为一个标准, 使用协议进行描述. 同时, 为了统一, 需要声明一个枚举类来描述权限状态, 因为虽然每个权限描述的内容都一样, 但是他们在不同的框架中, 用数字来进行描述. 所以这里我们需要声明一个类来统一他们.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Authority</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Status</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> notDetermined</span><br><span class="line">        <span class="keyword">case</span> restricted</span><br><span class="line">        <span class="keyword">case</span> denied</span><br><span class="line">        <span class="keyword">case</span> authorized</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其次, 我们要将权限的这些行为统一起来</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Authoritiable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 简易状态获取</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> isAvaliable: <span class="type">Bool</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 状态</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> status: <span class="type">Authority</span>.<span class="type">Status</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 申请权限</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAuthority</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里, 提供一个简易的查询状态, 来获取当前权限是否是允许的状态.</p>
<p>在协议的定义中, 我们使用了PromiseKit, 这是一个总线框架, 可以优雅的解决block回调地狱. 也很容易上手, 如果你没有接触过, 也没有关系, 在这里你先把它看成是一个回调, 随着后面代码的深入, 你会对它的用法有一个深刻的了解.</p>
<h2 id="建立组件"><a href="#建立组件" class="headerlink" title="建立组件"></a>建立组件</h2><p>对于请求权限这件事, 他是一个独立的功能, 或者说, 可以被其他的项目复用的功能, 所以在这里, 让我们把它做成一个组件, 有以下的几点好处:</p>
<ol>
<li>方便复用</li>
<li>为后续维护代码的人规定了如何维护, 对代码进行了物理隔离, 防止后面维护的人腐蚀框架结构</li>
</ol>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>首先我给它起个名字, 就叫Authority, 然后为了统一结构, 我会在这个文件夹下建立</p>
<ol>
<li>Classes文件夹</li>
<li>podspec描述文件</li>
<li>LICENSE</li>
</ol>
<p>统一了这样的结构后, 后面如果需要, 我们可以用脚本来生成这样的模板.</p>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p>首先要思考, 在这个项目中, 需要相机, 麦克风, 相册的权限功能, 但是在其他的项目中, 他可能只需要其中的几个, 比如相册或者推送功能. 那么, 如何组合, 如何扩展? 为了解决这个问题, 需要将这个组件分别定义为几个子组件, 由业务方按需索取.</p>
<p>在这里, 将相机, 麦克风, 相册权限分别定义为一个子组件. 然后由一个base组件将他们关联起来</p>
<p>首先在Classes文件夹下, 定义这几个组件的文件夹.<br>然后在定义podspec描述文件</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">s.default_subspec = <span class="string">'Base'</span></span><br><span class="line"></span><br><span class="line">s.ios.deployment_target = <span class="string">'10.0'</span></span><br><span class="line"></span><br><span class="line">s.swift_version = <span class="string">'5.0'</span></span><br><span class="line"></span><br><span class="line">s.subspec <span class="string">'Base'</span> <span class="keyword">do</span> <span class="params">|base|</span></span><br><span class="line">  base.source_files = <span class="string">'Classes/Base/*.&#123;swift&#125;'</span></span><br><span class="line">  base.dependency <span class="string">'PromiseKit'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">s.subspec <span class="string">'Video'</span> <span class="keyword">do</span> <span class="params">|video|</span></span><br><span class="line">  video.source_files = <span class="string">'Classes/Video/*.&#123;swift&#125;'</span></span><br><span class="line">  video.dependency <span class="string">'Authority/Base'</span></span><br><span class="line">  video.frameworks = <span class="string">'AVFoundation'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">s.subspec <span class="string">'Audio'</span> <span class="keyword">do</span> <span class="params">|audio|</span></span><br><span class="line">  audio.source_files = <span class="string">'Classes/Audio/*.&#123;swift&#125;'</span></span><br><span class="line">  audio.dependency <span class="string">'Authority/Base'</span></span><br><span class="line">  audio.frameworks = <span class="string">'AVFoundation'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">s.subspec <span class="string">'Photo'</span> <span class="keyword">do</span> <span class="params">|album|</span></span><br><span class="line">  album.source_files = <span class="string">'Classes/Photo/*.&#123;swift&#125;'</span></span><br><span class="line">  album.dependency <span class="string">'Authority/Base'</span></span><br><span class="line">  album.frameworks = <span class="string">'Photos'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>这里省略掉一些模板的内容, pod的描述文件是这样的, 需要注意的是定义了base之后, 需要让后面的subspec进行依赖, 同时需要指明自己所依赖的类文件的路径, 搞定后, 直接pod即可.</p>
<p>接下来, 工程结构有了, 基本类型也有了, 剩下的就是编码工作了.</p>
<h3 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h3><p>这里放的是协议, 即各模块的行为规范的描述, 之所以有这样的一个base层, 一个是为了行为规范, 其他模块需要实现协议, 统一方法, 防止架构被腐蚀; 另一个是为了解耦, 如果上层需要用到权限请求的抽象类, 而不是具体实现类的话, 那么就可以使用协议去描述. 所以这里的内容, 只有上面说到的协议和状态类型描述.</p>
<h3 id="Camera"><a href="#Camera" class="headerlink" title="Camera"></a>Camera</h3><p>具体实现, 拿相机权限的申请举例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> PromiseKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Authority</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Camera</span>: <span class="title">Authoritiable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">var</span> isAvaliable: <span class="type">Bool</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">AVCaptureDevice</span>.authorizationStatus(<span class="keyword">for</span>: .video) == .authorized</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> status: <span class="type">Authority</span>.<span class="type">Status</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="type">AVCaptureDevice</span>.authorizationStatus(<span class="keyword">for</span>: .video) &#123;</span><br><span class="line">            <span class="keyword">case</span> .authorized:</span><br><span class="line">                <span class="keyword">return</span> .authorized</span><br><span class="line">            <span class="keyword">case</span> .denied:</span><br><span class="line">                <span class="keyword">return</span> .denied</span><br><span class="line">            <span class="keyword">case</span> .notDetermined:</span><br><span class="line">                <span class="keyword">return</span> .notDetermined</span><br><span class="line">            <span class="keyword">case</span> .restricted:</span><br><span class="line">                <span class="keyword">return</span> .restricted</span><br><span class="line">            @unknown <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">fatalError</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAuthority</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">Bool</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Promise</span>&lt;<span class="type">Bool</span>&gt; &#123; (seal) <span class="keyword">in</span></span><br><span class="line">                <span class="type">AVCaptureDevice</span>.requestAccess(<span class="keyword">for</span>: .video) &#123; (result) <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> result &#123;</span><br><span class="line">                        seal.fulfill(result)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        seal.reject(<span class="type">Error</span>.accessDeny)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里, 对Authority进行扩展, 增加不同权限的, 这样, 我们不需要对原有的代码修改, 就可以增加新的功能, 其他的功能, 都可以如法炮制, 例如相册权限</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Photos</span><br><span class="line"><span class="keyword">import</span> PromiseKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">Authority</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Photo</span>: <span class="title">Authoritiable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> isAvaliable: <span class="type">Bool</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">PHPhotoLibrary</span>.authorizationStatus() == .authorized</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> status: <span class="type">Authority</span>.<span class="type">Status</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="type">PHPhotoLibrary</span>.authorizationStatus() &#123;</span><br><span class="line">            <span class="keyword">case</span> .authorized:</span><br><span class="line">                <span class="keyword">return</span> .authorized</span><br><span class="line">            <span class="keyword">case</span> .denied:</span><br><span class="line">                <span class="keyword">return</span> .denied</span><br><span class="line">            <span class="keyword">case</span> .notDetermined:</span><br><span class="line">                <span class="keyword">return</span> .notDetermined</span><br><span class="line">            <span class="keyword">case</span> .restricted:</span><br><span class="line">                <span class="keyword">return</span> .restricted</span><br><span class="line">            @unknown <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">fatalError</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">requestAuthority</span><span class="params">()</span></span> -&gt; <span class="type">Promise</span>&lt;<span class="type">Bool</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Promise</span>&lt;<span class="type">Bool</span>&gt; &#123; (seal) <span class="keyword">in</span></span><br><span class="line">                <span class="type">PHPhotoLibrary</span>.requestAuthorization &#123; (result) <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> result == .authorized &#123;</span><br><span class="line">                        seal.fulfill(<span class="literal">true</span>)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        seal.reject(<span class="type">Error</span>.accessDeny)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在我们写组件的时候, 需要注意的是访问权限的修饰, 如果在你写好了组件, 发现有一些组件的方法或者属性无法通过提示获取到, 那么很有可能你使用了错误的访问权限控制修饰. 在这里, 我们不需要继承复写, 所以, public足够了. 这里有<a href="https://docs.swift.org/swift-book/LanguageGuide/AccessControl.html" target="_blank" rel="noopener">苹果官方的详细文档</a> </p>
<h1 id="收益"><a href="#收益" class="headerlink" title="收益"></a>收益</h1><p>在这里, 我们来对比一下这样的做法有什么收益</p>
<p>首先, 看一下, 如果不用PromiseKit, 代码会是什么样子呢?</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AVCaptureDevice</span>.requestAccess(<span class="keyword">for</span>: .video) &#123; (resultVidoe) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> resultVidoe &#123;</span><br><span class="line">                <span class="type">AVCaptureDevice</span>.requestAccess(<span class="keyword">for</span>: .audio) &#123; (resultAudio) <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> resultAudio &#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>可以看出, 串行请求时, 代码已经惨不忍睹了, 而且这样写, 并不是我们想要的, 因为一个权限的请求与否, 并不依赖于其他权限, 但是我们需要他们顺序的展示出来, 市面上有一些app, 会疯狂的弹出权限请求, 你还没看清一个弹窗, 另一个弹窗就出来了, 这是因为他们并行的请求了这些权限, 为什么不等一个完成后, 再去请求另一个呢? 我想, 这样的代码并没有那么好写, 而且无论怎样组合, 这样的回调嵌套都不那么容易阅读, 那么, 如果我们用我们这一节的内容包装一下呢?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Authority.Camera.requestAuthority()</span><br><span class="line">            .then &#123; _ in Authority.Audio.requestAuthority() &#125;</span><br><span class="line">            .catch &#123; (error) in print(error) &#125;</span><br></pre></td></tr></table></figure>
<p>这个代码是在请求完相机权限后, 请求麦克风权限. 从代码阅读上来看, 这样就清晰很多. </p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>在这一章节, 展示了如何将权限请求的功能封装成一个组件, 并增加扩展性, 让它符合开闭原则. 同时接触了PromiseKit这个事件总线. 展示了如何优雅的按照顺序获取权限. 但是需要注意的是, 根据工信部的要求, 弹出的权限请求, 只有在必要时才能进行, 代码虽雅, 也还是要遵循需求.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/19/从YYCache学习设计一个CaChe-in-Swift/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/19/从YYCache学习设计一个CaChe-in-Swift/" class="post-title-link" itemprop="url">从YYCache学习设计一个CaChe in Swift</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-19 22:39:36" itemprop="dateCreated datePublished" datetime="2018-09-19T22:39:36+08:00">2018-09-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-11-21 19:46:48" itemprop="dateModified" datetime="2018-11-21T19:46:48+08:00">2018-11-21</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h1><p>提到缓存这个词, 我们并不陌生, 从硬件到软件, 从服务端到客户端, 我们都有用到各种各样的缓存. 甚至在面试中, 也会有类似的问题. 今天, 我们就通过将一个大家熟悉的库–YYCache, 由OC改写成Swift, 来学习如何设计一个Cache<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/09/19/从YYCache学习设计一个CaChe-in-Swift/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/13/Using-Collections-Effectively/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/13/Using-Collections-Effectively/" class="post-title-link" itemprop="url">Using Collections Effectively</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-13 16:25:46" itemprop="dateCreated datePublished" datetime="2018-06-13T16:25:46+08:00">2018-06-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-08-27 06:33:02" itemprop="dateModified" datetime="2018-08-27T06:33:02+08:00">2018-08-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="一个没有集合的世界"><a href="#一个没有集合的世界" class="headerlink" title="一个没有集合的世界"></a>一个没有集合的世界</h1><blockquote>
<p>假如世界没有集合</p>
</blockquote>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/06/13/Using-Collections-Effectively/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/17/320遇到的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/17/320遇到的问题/" class="post-title-link" itemprop="url">320遇到的问题</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-17 21:20:33" itemprop="dateCreated datePublished" datetime="2018-05-17T21:20:33+08:00">2018-05-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-06-08 22:46:34" itemprop="dateModified" datetime="2018-06-08T22:46:34+08:00">2018-06-08</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h1><p>好久没有写设么了, 太累了, 今天有点小空, 记录一下</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/05/17/320遇到的问题/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/05/OpenGLES-2-Shader使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/05/OpenGLES-2-Shader使用/" class="post-title-link" itemprop="url">OpenGLES-2-Shader使用</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-05 23:22:25" itemprop="dateCreated datePublished" datetime="2018-04-05T23:22:25+08:00">2018-04-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-05-26 22:03:34" itemprop="dateModified" datetime="2018-05-26T22:03:34+08:00">2018-05-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Begin"><a href="#Begin" class="headerlink" title="Begin"></a>Begin</h1><p>继续跟着落影的教程走下去. 这一节是用shader, 教程中使用的2x的glsl, 而我想改为使用3x版本的.<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/04/05/OpenGLES-2-Shader使用/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/04/OpenGLES-1-GLKit简单使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/04/OpenGLES-1-GLKit简单使用/" class="post-title-link" itemprop="url">OpenGLES-1-GLKit简单使用</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-04 22:20:32" itemprop="dateCreated datePublished" datetime="2018-04-04T22:20:32+08:00">2018-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-04-05 23:18:48" itemprop="dateModified" datetime="2018-04-05T23:18:48+08:00">2018-04-05</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Begin"><a href="#Begin" class="headerlink" title="Begin"></a>Begin</h1><p>一直觉得图形图像这块很神秘, 既然工作中用到了, 那就学习一下. 碰巧部门培训也包含了OpenGL这块, 那就顺便加深一下印象.<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/04/04/OpenGLES-1-GLKit简单使用/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/29/AVAudioEngie-bug-处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/29/AVAudioEngie-bug-处理/" class="post-title-link" itemprop="url">AVAudioEngie bug 处理</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-29 14:57:44" itemprop="dateCreated datePublished" datetime="2018-03-29T14:57:44+08:00">2018-03-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-04-05 23:23:24" itemprop="dateModified" datetime="2018-04-05T23:23:24+08:00">2018-04-05</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Begin"><a href="#Begin" class="headerlink" title="Begin"></a>Begin</h1><p>开发的AVAudioEngine上线了, 但是莫名的crash率高居榜首. 要不是转正前修复了一个历史遗留大bug, 老大早把我卸载了.<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/03/29/AVAudioEngie-bug-处理/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/07/AudioEngine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/07/AudioEngine/" class="post-title-link" itemprop="url">AudioEngine</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-07 15:33:18" itemprop="dateCreated datePublished" datetime="2018-03-07T15:33:18+08:00">2018-03-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-04-04 22:21:05" itemprop="dateModified" datetime="2018-04-04T22:21:05+08:00">2018-04-04</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Begin"><a href="#Begin" class="headerlink" title="Begin"></a>Begin</h1><p>本文涉及到 avaudioBuffer 转 sampleBuffer, 并通过 avassetWriter 写流<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/03/07/AudioEngine/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/18/Album开发总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ArthurChi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/18/Album开发总结/" class="post-title-link" itemprop="url">Album开发总结</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-18 09:56:20" itemprop="dateCreated datePublished" datetime="2018-01-18T09:56:20+08:00">2018-01-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-02-22 22:26:45" itemprop="dateModified" datetime="2018-02-22T22:26:45+08:00">2018-02-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h1><p>从北京到深圳, 来到脸萌, 第一个任务就是重构相册功能模块, 其实也算简单, 只是一个查询并展示功能. 但是一些细节问题, 还是需要记录一下.<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2018/01/18/Album开发总结/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Author</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">98</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">92</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Author</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
